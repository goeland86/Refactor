---
- name: Recore - Install packages
  apt:
    name:
      - libgirepository1.0-dev
      - libcairo2-dev
      - at-spi2-core
      - libdbus-1-3
      - libdbus-1-dev
      - gir1.2-gtk-3.0
      - python3-gi
      - python3-gi-cairo
      - pkg-config
      - gcc
      - xinit
      - xinput
      - x11-xserver-utils
      - xdotool
      - xserver-xorg-video-fbdev
    state: latest

- name: Recore - download klipperscreen
  unarchive:
    src: https://github.com/intelligent-agent/KlipperScreen/archive/refs/heads/master.zip
    dest: /home/debian/
    owner: debian
    group: debian
    remote_src: yes

- name: Recore - Rename folder
  command: mv /home/debian/KlipperScreen-master /home/debian/KlipperScreen

- name: Recore - Install KlipperScreen
  shell:
    cmd: "DEBIAN_FRONTEND=noninteractive sudo -u debian /home/debian/KlipperScreen/scripts/KlipperScreen-install.sh"

- name: Recore - install service file
  copy:
    src: KlipperScreen.service
    dest: /etc/systemd/system/
    mode: 0644

- name: Recore - install config file
  copy:
    src: KlipperScreen.conf
    dest: /home/debian/printer_data/config
    owner: debian
    group: debian
    mode: 0755

- name: Recore - Enable KlipperScreen
  systemd:
    name: KlipperScreen.service
    enabled: yes

- name: Recore - Add debian to netdev
  user:
    name: debian
    groups: netdev
    append: yes
